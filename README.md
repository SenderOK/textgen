# textgen

Генератор случайных текстов на английском языке на основе марковских моделей.

### Общая информация

Поддерживается генерация текста со следующими шестью знаками препинания: . ! ? , : ;

Корректно поддерживаются большие буквы. Для большей человечности производится разбиение текста на абзацы.

###  Состав репозитория и основные функции
Основной модуль - textgen.py, он содержит описание генератора текстов и всех вспомогательных классов.

Небольшой пример использования реализованного генератора содержится в файле test_run_textgen.py. Папка small_corpus содержит небольшой набор текстов для обучения модели в этом примере (~1 000 000 слов). Результат работы генератора на этом примере приведен в файле test_generated_text.txt

Скрипт для использования генератора на большом корпусе текстов Азимова, Пратчетта и Диккенса (~16 000 000 слов) - run_textgen.py, результат его работы приведен в файле generated_text.txt.

Для обучения генератора достаточно вызвать функцию train с путем до папки, содержащей корпус тектов. Она будет обойдена рекурсивно, будут считаны все файлы с расширением .txt. Предполагаемая кодировка - utf-8.

Для генерации текста достаточно вызвать функцию generate_text, принимающую на вход минимальное число слов в тексте, число предложений в каждом абзаце.

Предусмотрены методы save_model и load_model, позволяющие сохранять и загружать модели. Они реализованы с помощью модуля pickle.

### Детали реализации
Сперва в классе **TextLemmatizer** каждый из исходных текстов с помощью регулярных выражений очищается от лишних символов и разбивается на леммы. **Леммами** называются последовательности из латинских букв, цифр и апострофов (слова), а также 6 поддерживаемых знаков препинания (из них три завершают предложение, три других могут находиться внутри предложения). Слова, содержащие апострофы в начале или в конце, удаляются. Слова, находящиеся в начале предложения или содержащие большие буквы в середине, переводятся в нижний регистр. Для различения разных типов лемм используется перечисление **LemmaType**.

В основном классе **TextGenerator** каждая лемма кодируется числом. Для кодирования и декодирования используются два словаря, реализованы специальные методы. Кодированные числами леммы по одному предложению подаются на вход классу **MarkovChainModel**, в котором накапливается вся статистика и затем осуществляется генерация следующего слова на основе предыдущих. Этот класс реализует марковскую модель произвольного порядка, по умолчанию используется значение 2 согласно заданию. Хранение и генерация числа в классе **MarkovChainModel** основывается на классе **FrequencyDistribution**: пустому набору, каждому слову, паре слов, ... , n-грамме ставится в соответствие распределение леммы, идущей далее. Отдельно хранится распределение слов, встретившихся в начале предложения. Из него берутся первые слова для предложений генерируемого текста.

**FrequencyDistribution** основывается на встроенном классе **Counter**. Генерация элемента производится согласно хранящимся в счетчике частотам. Для быстродействия при первой генерации из данного распределения строится и запоминается массив кумулятивных сумм для частот, по которому в дальнейшем осуществляется бинпоиск, за счет чего генерация осуществляется за log(числа слов в данном счетчике).  

В классе **TextGenerator** поддерживается статистика по общему числу слов и числу уникальных слов, встретившихся в обучении, она выводится на печать в процессе обучения.

Генерация текста производится по предложениям. Первое слово берется из распределения первых слов, второе слово берется из распределения, соответствующего первому слову, третье - в соответствии с двумя предыдущими словами и т.д. - до появления знака препинания, завершающего предложение.

Весь код на python pep8-ирован :)

### Результаты запусков
Обучение на выданном корпусе текстов Азимова, Пратчетта и Диккенса занимает порядка 4-5 минут (процессор Intel Core i7 1.7 GHz, оперативная память 8GB). Еще примерно столько же занимает работа модуля pickle, если вызывается функция сохранения построенной модели. Текст генерируется за несколько секунд. Как легко видеть из примеров, текст получается вполне адекватным.
